---
title: 说明
sidebar:
    order: 0
---

## MySQL体系结构

![MySQL体系结构图](@assets/mysql/20210303232240506.png)

- `连接层` - 最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证、及相关安全方案
- `服务层` - 第二层主要完成大多数的核心服务功能，如 SQL 接口，并完成缓存的查询，SQL 的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，过程、函数等
- `引擎层` - 存储引擎负责 MySQL 中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，可以选择合适的存储引擎或自定义存储引擎
- `存储层` - 主要将数据存储在文件系统上，并完成与存储引擎的交互

## 存储引擎简介

存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可以称为表类型

```sql
-- 建表时指定存储引擎
CREATE TABLE 表名(
    字段1 字段1类型 [COMMENT '字段1注释'],
    字段2 字段2类型 [COMMENT '字段2注释'],
    字段3 字段3类型 [COMMENT '字段3注释'],
    ...
    字段N 字段N类型 [COMMENT '字段N注释']
) ENGINE=INNODB [COMMENT '表注释'];

-- 查看数据库支持的存储引擎
SHOW ENGINES;
```

### MyISAM

MyISAM 是早期的默认存储引擎

不支持事务，不支持外键。支持表锁，不支持行锁。访问速度快

相关文件：

- `table_name.sdi` - 存储表结构信息，就是json文件
- `table_name.MYD` - 存储数据
- `table_name.MYI` - 储存索引

### Memory

Memory 引擎的表数据是存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为作为临时表或缓存使用

内存存放，hash索引（默认）

只有 `table_name.sdi` 文件来存储表结构信息

### InnoDB

InnoDB 是一种兼顾高可靠和高性能的通用存储引擎，在 MySQL5.5 之后，InnoDB 是默认的存储引擎

InnoDB 的 `DML` 操作遵循 `ACID` 模型，支持 `事务`

InnoDB 支持 `外键` FOREIGN KEY 约束，保证数据的完整性和正确性

支持 `行级锁`，提高并发访问性能

`table_name.ibd` 文件：InnoDB 引擎的每张表都会对应这样一张表空间文件，存储该表的表结构（frm、sdi）、数据和索引，

使用 `SHOW VARIABLES LIKE 'innodb_file_per_table';` 查看 `每张表是否有单独的表空间文件` 配置是否打开

### 存储引擎对比

| 特点             | InnoDB            | MyISAM | Memory |
| ---------------- | ----------------- | ------ | ------ |
| **存储限制**     | 64TB              | 有     | 有     |
| **事务安全**     | 支持              | -      | -      |
| **锁机制**       | 行锁              | 表锁   | 表锁   |
| **B+Tree索引**   | 支持              | 支持   | 支持   |
| **Hash索引**     | -                 | -      | 支持   |
| **全文索引**     | 支持（5.6版本后） | 支持   | -      |
| **空间使用**     | 高                | 低     | N/A    |
| **内存使用**     | 高                | 低     | 中等   |
| **批量插入速度** | 低                | 高     | 高     |
| **支持外键**     | 支持              | -      | -      |
