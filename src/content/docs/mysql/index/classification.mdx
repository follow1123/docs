---
title: 分类
sidebar:
    order: 10
---

| 分类     | 关键字     | 含义                                                         | 特点                        |
| -------- | ---------- | ------------------------------------------------------------ | --------------------------- |
| 主键索引 | `PRIMARY`  | 针对表中主键创建的索引                                       | 默认自动创建<br/>只能有一个 |
| 唯一索引 | `UNIQUE`   | 避免同一个表中<br/>某数据列中的值重复                        | 可以有多个                  |
| 常规索引 |            | 快速定位特定的数据                                           | 可以有多个                  |
| 全文索引 | `FULLTEXT` | 全文索引查找的是<br/>文本中的关键字<br/>而不是比较索引中的值 | 可以有多个                  |

在 InnoDB 存储引擎中，根据索引的存储形式，又可以分为以下两种

| 分类                          | 含义                                                          | 特点                 |
| ----------------------------- | ------------------------------------------------------------- | -------------------- |
| `聚集索引（Clustered Index）` | 将数据存储与索引放在一块<br/>索引结构的叶子节点保存了行数据   | 必须又，而且只有一个 |
| `二级索引（Secondary Index）` | 将数据与索引分开存储<br/>索引结构的叶子节点关联的是对应的主键 | 可以存在多个         |

聚集索引选取规则：

- 如果存在主键，主键索引就是聚集索引
- 如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引
- 如果既没有主键，也没有唯一索引，则 InnoDB 会自动生成一个 rowid 作为隐藏的聚集索引

## 回表查询

有一张用户表 `user`，表内有 `id`、`name` 两个字段

- 其中 `id` 字段是主键，也就是聚集索引
- `name` 字段创建了索引，也就是二级索引

`SELECT * FROM user WHERE name = 'zs';`

- 这样一条sql会先走二级索引，找到 `name` 对应的 `id`
- 再根据 `id` 走聚集索引，找到这行的数据
- 这个过程就叫 `回表查询`

## InnoDB 主键索引的 B+Tree 高度和数据量直接的关系

假设一行数据为1k，一页（默认大小为16k）可以存储16行这样的数据。InnoDB的指针占用6个字节，主键为 bigint，占用8个字节

如果树的高度为2

- 设一页可以存放的主键个数为n
- `n * 8 + (n + 1) - 6 = 16 * 1024`
- 可以得出n约为1170，所以一页（默认16k）可以存储1170个主键，和1171个指针
- 1171指针又指向1171个页
- 所以高度为2的B+Tree大约可以存储1171 \* 16 = 18736条数据
