---
title: 磁盘/设备
sidebar:
    order: 40
---

| 命令              | 描述                               |
| ----------------- | ---------------------------------- |
| [df](#df)         | 查看文件系统的磁盘空间使用情况     |
| [du](#du)         | 查看指定目录或文件的磁盘使用情况   |
| [lsblk](#lsblk)   | 列出块设备，包括硬盘、分区和挂载点 |
| [blkid](#blkid)   | 查看块设备的 UUID 和文件系统类型   |
| [lspci](#lspci)   | 列出所有 PCI 设备                  |
| [fdisk](#fdisk)   | 管理磁盘分区                       |
| [parted](#parted) | 管理磁盘分区                       |
| [mkfs](#mkfs)     | 创建文件系统                       |
| [mount](#mount)   | 挂载文件系统                       |
| [umount](#umount) | 卸载文件系统                       |
| [fsck](#fsck)     | 检查和修复文件系统错误             |
| [sync](#sync)     | 把内存的数据同步到磁盘             |

## `df`

- `-h` - 以人类可读的格式显示（例如，以 KB、MB、GB 为单位）
- `-a` - 包括所有文件系统，包括大小为 0 的文件系统
- `-T` - 显示文件系统类型
- `-i` - 显示 inode 使用情况，而不是磁盘空间
- `--total` - 显示所有文件系统的总计

```bash
# 以可读的方式显示所有文件系统信息
df -h

# 显示home目录的文件系统信息
df -h /home
```

## `du`

- `-h` - 以人类可读的格式显示（例如，以 KB、MB、GB 为单位）
- `-s` - 仅显示总计，不递归显示每个子目录
- `-c` - 显示总计
- `--max-depth=N` - 限制显示的子目录层级，N 为深度

```bash
# 显示home目录下所有文件的磁盘占用情况
du -h /home

# 显示home目录下深度3层的所有文件信息，并统计
du -hc --max-depth=3 /home
```

## `lsblk`

- `-a` - 显示所有设备，包括未挂载的设备
- `-f` - 显示文件系统类型和UUID等信息
- `-l` - 以列表形式显示输出
- `-p` - 显示完整的设备路径

## `blkid`

- `-o` - 指定输出格式，常见的选项有value、udev和full
- `-s` - 指定要显示的属性，例如UUID、LABEL等
- `-c` - 指定一个缓存文件，以避免频繁访问设备
- `-p` - 在查找设备之前查看设备的状态

## `lspci`

- `-v` - 显示详细信息
- `-vv` - 显示更详细的信息
- `-s` - 只显示特定设备的信息，例如 lspci -s 00:1f.2
- `-n` - 以数字格式显示设备 ID，而不是名称
- `-k` - 显示设备驱动程序信息
- `-t` - 以树形结构显示设备关系

## `fdisk`

- `-l` - 显示系统内所有磁盘的所有分区信息

```bash
# 必须指定硬盘名称进行操作，不能使用 /dev/sda1 之类的分区文件
# 进入 fdisk 的交互式命令环境
# m  显示所有命令列表
# p  显示磁盘分区
# n  新增分区
# d  删除分区
# w  写入并退出
sudo fdisk /dev/<device_name>

```

## `parted`

和 fdisk 类似的命令行分区工具，进入交互式环境后输入 help 显示帮助信息

## `mkfs`

- `-t FSTYPE` - 指定文件系统类型，例如 ext4、xfs、vfat 等
- `-n` - 不执行格式化，只显示所需的操作

```bash
# 将指定磁盘格式化为ext4文件系统
mkfs -t ext4 /dev/<devname>
```

## `mount`

被挂载的目录必须要提前创建

- `-t FSTYPE` - 指定文件系统类型（如 ext4、xfs、ntfs 等）
- `-o OPTIONS` - 指定挂载选项，例如 ro（只读）、rw（读写）、noexec（禁止执行文件）
- `-v` - 显示详细输出

```bash
# 将某个设备挂载到指定路径下
mount /dev/<devname> <dir>

# 将某个设备挂载到指定路径下，并指定ext4文件系统
mount -t ext4 /dev/<devname> <dir>
```

## `umount`

- `-a` - 卸载`/etc/mtab`中列出的所有文件系统
- `-r` - 在卸载失败时，尝试以只读方式卸载
- `-l` - 懒惰卸载，即在文件系统不再被使用后再真正卸载
- `-f` - 强制卸载，即使设备处于忙碌状态

```bash
# 卸载指定目录
umount <dir>
```

## `fsck`

- `-a` - 自动修复文件系统中的错误（可能会忽略一些问题）
- `-y` - 对所有问题自动回答“是”，进行修复
- `-n` - 不进行修复，只显示问题
- `-t` - 指定检查的文件系统类型（如 ext4、xfs 等）
- `-f` - 强制检查，即使文件系统看起来是干净的

```bash
# 检查指定磁盘设备
fsck /dev/<devname>
```

## `sync`

- 通常在关机或卸载文件系统前执行，用于保存数据都被写入
