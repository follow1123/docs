---
title: 进程/服务
sidebar:
    order: 15
---

import InternalLink from "@components/InternalLink.astro";

| 命令                                                           | 描述                               |
| -------------------------------------------------------------- | ---------------------------------- |
| [ps](#ps)                                                      | 查看当前运行的进程                 |
| [top](#top)                                                    | 实时显示进程信息和系统资源使用情况 |
| [kill](#kill)                                                  | 终止指定的进程                     |
| [pkill](#pkill)                                                | 根据名称终止进程                   |
| <InternalLink text="systemctl" href="linux/systemd/service" /> | systemd 服务管理                   |
| [service](#service)                                            | SysVinit 服务管理                  |

import { Kbd } from "starlight-kbd/components";

## `ps`

- `ps -ef` - 标准风格显示
- `ps axu` - BSD风格显示
- `ps axjf` - 树形结构显示

### 字段说明

#### `ps -ef` 标准格式

- `UID` - 用户id
- `PID` - 进程id
- `PPID` - 父进程id
- `C` - CPU使用率
- `STIME` - 进程启动的时间，`时:分`
- `TTY` - 终端名称
- `TIME` - 该进程占用CPU累计的总时间
- `CMD` - 启动进程的命令和参数

#### `ps axu` BSD风格格式

- `USER` - 用户id
- `PID` - 进程id
- `%CPU` - CPU使用率
- `%MEM` - 进程占用物理内存的百分比
- `VSZ` - 进程占用的虚拟内存大小(单位:KB)
- `RSS` - 进程占用的物理内存大小(单位:KB )
- `TTY` - 终端名称,缩写．
- `STAT` - 进程状态
    - `D` - 不可中断睡眠（通常为 IO）
    - `I` - 空闲内核线程
    - `R` - 正在运行或可运行（在运行队列中）
    - `S` - 可中断睡眠（等待事件完成）
    - `T` - 由作业控制信号停止
    - `t` - 在跟踪期间由调试器停止
    - `W` - 分页（自 2.6.xx 内核起无效）
    - `X` - 已死（永远不应出现）
    - `Z` - 已停止（"僵尸"）进程，已终止但未被其父进程收割
    - BSD风格额外信息：
        - `<` - 高优先级（对其他用户不好）
        - `N` - 低优先级（对其他用户好）
        - `L` - 将页面锁定在内存中（用于实时和自定义 IO）
        - `s` - 是会话领导者
        - `l` - 是多线程的（使用 CLONE_THREAD，就像 NPTL pthreads 一样）
        - `+` - 位于前台进程组中
- `STARTED` - 进程启动的时间，`时:分`
- `TIME` - 该进程占用CPU累计的总时间
- `COMMAND` - 启动进程的命令和参数

#### `ps axjf` 树形结构格式

- `PPID` - 父进程id
- `PID` - 进程id
- `PGID` - 进程组id，标识进程所属的进程组
- `SID` - 会话id，标识进程所属的会话
- `TTY` - 终端名称,缩写．
- `TPGID` - 终端进程组id，标识当前终端的前台进程组
- `STAT` - 进程状态
- `UID` - 用户id
- `TIME` - 该进程占用CPU累计的总时间
- `COMMAND` - 启动进程的命令和参数

### 常用命令

```bash
# 查询指定进程id的进程信息
ps <pid>

# 查询指定命令的进程信息
ps -C <cmd>

# 查询指定用户的进程信息
ps -u <username>

# 查询指定组的进程信息
ps -g <groupname>

# 查看指定进程下的所有子进程
ps --ppid <parentpid>
```

## `top`

> 一个交互式命令

### 界面说明

#### 顶部信息（第一行）

- 当前系统时间
- 系统运行时间
- 登录用户数
- 负载平均值
    - 过去1分钟、5 分钟和15分钟的平均负载

#### 任务信息（第二行）

- 进程总数
- 运行状态
- 休眠状态
- 停止状态
- 僵尸进程

#### CPU使用情况（第三行）

- `us` - 用户空间占用的CPU百分比
- `sy` - 内核空间占用的CPU 百分比
- `ni` - 用户进程的优先级调整所占用的CPU百分比
- `id` - 空闲CPU百分比
- `wa` - 等待I/O操作所占用的CPU百分比
- `hi` - 硬件中断处理时间
- `si` - 软件中断处理时间
- `st` - 在虚拟化环境中，CPU 被其他虚拟机使用的时间

#### 内存和交换区信息（第四、五行）

- 总内存
- 空闲内存
- 已用内存
- 缓存

#### 进程列表

- `PID` - 进程ID
- `USER` - 进程所有者的用户名
- `PR` - 进程的优先级
- `NI` - 进程的nice值，影响优先级
- `VIRT` - 进程使用的虚拟内存总量
- `RES` - 进程使用的实际物理内存量
- `SHR` - 进程使用的共享内存量
- `S` - 进程状态（如 R: 运行, S: 睡眠, Z: 僵尸等）
- `%CPU` - 进程占用的CPU百分比
- `%MEM` - 进程占用的内存百分比
- `TIME+` - 进程使用的CPU时间总和
- `COMMAND` - 运行的命令或进程名称

### 快捷键

- `q` - 退出
- `?/h` - 显示帮助信息
- `E` - 修改第四、五行内存单位
- `e` - 修改进程列表处的单位
- `l` - 显示或隐藏第一行信息
- `t` - 显示、隐藏或修改CPU信息样式
- `m` - 显示、隐藏或修改内存交换区信息样式
- `1` - 显示所有CPU线程信息
- `L` - 搜索进程信息
- `c` - `COMMAND`列显示详细命令
- `i` - 显示空间进程
- `u` - 输入用户名搜索进程
- `V` - 以树结构显示进程列表
- `d` - 修改更新间隔
- `k` - 给指定进程发送信号（默认sigterm）

### 常用命令

```bash
# 只显示指定用户的进程信息
top -u <username>

# 设置信息更新间隔
top -d <seconds>
```

## `kill`

- `-l` - 列出所有信号
- `-s <signal>` - 指定发送的信号

```bash
# 终止进程，默认是发送的SIGTERM(15)信号
kill <pid>

# 强制终止进程，发送的SIGKILL(9)信号
kill -9 <pid>

# 和上面一样
kill -s SIGKILL <pid>

# 显示所有可以发送的信号
kill -l
```

### 信号

| 信号名称    | 信号编号 | 描述                                                 |
| ----------- | -------- | ---------------------------------------------------- |
| `SIGHUP`    | 1        | 挂起信号，通常用于通知进程重新加载配置               |
| `SIGINT`    | 2        | 中断信号，通常由用户按<Kbd linux="ctrl+c" />发送     |
| `SIGQUIT`   | 3        | 退出信号，通常由用户按<Kbd linux="ctrl+\" />发送     |
| `SIGILL`    | 4        | 非法指令信号，程序执行了非法操作                     |
| `SIGTRAP`   | 5        | 调试信号，通常用于断点调试                           |
| `SIGABRT`   | 6        | 中止信号，由`abort()`函数发送                        |
| `SIGBUS`    | 7        | 总线错误信号，通常由于内存访问错误引起               |
| `SIGFPE`    | 8        | 算术错误信号（如除零错误）                           |
| `SIGKILL`   | 9        | 强制终止信号，无法被捕获或忽略                       |
| `SIGUSR1`   | 10       | 用户定义信号 1，用户可以自定义用途                   |
| `SIGSEGV`   | 11       | 段错误信号，通常由于无效内存访问引起                 |
| `SIGUSR2`   | 12       | 用户定义信号 2，用户可以自定义用途                   |
| `SIGPIPE`   | 13       | 管道破裂信号，尝试写入已关闭的管道                   |
| `SIGALRM`   | 14       | 定时器到期信号，通常用于定时操作                     |
| `SIGTERM`   | 15       | 请求终止信号，允许进程优雅地关闭                     |
| `SIGSTKFLT` | 16       | 堆栈错误信号                                         |
| `SIGCHLD`   | 17       | 子进程停止或退出信号                                 |
| `SIGCONT`   | 18       | 继续执行信号，恢复被暂停的进程                       |
| `SIGSTOP`   | 19       | 暂停信号，无法被捕获或忽略                           |
| `SIGTSTP`   | 20       | 终端停止信号，通常由用户按<Kbd linux="ctrl+z" />发送 |
| `SIGTTIN`   | 21       | 后台进程尝试读取终端信号                             |
| `SIGTTOU`   | 22       | 后台进程尝试写入终端信号                             |
| `SIGBUS`    | 23       | 错误信号，通常由于访问无效内存引起                   |
| `SIGPOLL`   | 24       | 轮询信号，通常用于文件描述符                         |
| `SIGPROF`   | 25       | 进程的统计信息到达                                   |
| `SIGSYS`    | 26       | 无效系统调用信号                                     |
| `SIGUNUSED` | 27       | 未使用的信号                                         |

## `pkill`

- 指定进程名称发送终止信号

```bash
# 发送终止信号到指定名称的进程
pkill <pname>

# 指定父进程id发送终止信号到其下得所有子进程
pkill -P <ppid>
```

## `service`

```bash
# 启动服务
service <servicename> start

# 重启服务
service <servicename> restart

# 查看服务状态
service <servicename> status

# 重新加载服务配置文件
service <servicename> reload

# 停止服务
service <servicename> stop
```
