---
import MermaidClient from "./MermaidClient.astro";
import MermaidStatic from "./MermaidStatic.astro";
import generate from "@/libs/mermaid/generator";
import type { SvgFile } from "@/libs/mermaid/generator";

const isDev = import.meta.env.DEV;

interface Props {
  code: string;
}

const { code } = Astro.props;

// 初始化空值，防止下面 html 代码内无效的错误提示
let svgFile: SvgFile = { lightPath: "", darkPath: "", width: "" };
if (!isDev) {
  let filePath = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
  if (filePath.startsWith("/")) {
    filePath = filePath.slice(1);
  }
  svgFile = await generate(filePath, code);
}
---

{
  isDev ? (
    <MermaidClient code={code} />
  ) : (
    <MermaidStatic
      lightPath={svgFile.lightPath}
      darkPath={svgFile.darkPath}
      width={svgFile.width}
    />
  )
}
